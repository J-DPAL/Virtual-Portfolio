services:
  monolith-service:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: portfolio-monolith-service
    environment:
      SERVER_PORT: ${SERVER_PORT:-8080}
      SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE:-prod}
      SPRING_DATASOURCE_URL: ${SPRING_DATASOURCE_URL}
      SPRING_DATASOURCE_USERNAME: ${SPRING_DATASOURCE_USERNAME}
      SPRING_DATASOURCE_PASSWORD: ${SPRING_DATASOURCE_PASSWORD}
      SUPABASE_URL: ${SUPABASE_URL}
      SUPABASE_ANON_KEY: ${SUPABASE_ANON_KEY}
      SUPABASE_SERVICE_ROLE_KEY: ${SUPABASE_SERVICE_ROLE_KEY}
      APP_CORS_ALLOWED_ORIGINS: ${APP_CORS_ALLOWED_ORIGINS:-http://localhost:3000,http://localhost:5173}
      APP_AUTH_COOKIE_FORCE_SECURE: ${APP_AUTH_COOKIE_FORCE_SECURE:-false}
      CONTACT_IP_HASH_SALT: ${CONTACT_IP_HASH_SALT:-local-dev-salt-change-me}
      TURNSTILE_ENABLED: ${TURNSTILE_ENABLED:-false}
      TURNSTILE_SECRET_KEY: ${TURNSTILE_SECRET_KEY:-}
      TURNSTILE_MINIMUM_SCORE: ${TURNSTILE_MINIMUM_SCORE:-0.5}
      SUPABASE_RESUME_BUCKET: ${SUPABASE_RESUME_BUCKET:-resumes}
      RESUME_FILE_EN: ${RESUME_FILE_EN:-resume_en.pdf}
      RESUME_FILE_FR: ${RESUME_FILE_FR:-resume_fr.pdf}
      RESUME_FILE_ES: ${RESUME_FILE_ES:-resume_es.pdf}
    ports:
      - "8080:8080"

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        VITE_API_BASE_URL: ${VITE_API_BASE_URL:-http://localhost:8080/api}
    container_name: portfolio-frontend
    ports:
      - "3000:3000"
    depends_on:
      - monolith-service

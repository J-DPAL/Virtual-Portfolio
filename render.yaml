services:
  - type: web
    name: portfolio-monolith
    env: docker
    plan: free
    dockerfilePath: backend/Dockerfile
    dockerContext: backend
    autoDeploy: true
    envVars:
      - key: SERVER_PORT
        value: "8080"
      - key: SPRING_PROFILES_ACTIVE
        value: prod
      - key: APP_CORS_ALLOWED_ORIGINS
        sync: false
      - key: SPRING_DATASOURCE_URL
        sync: false
      - key: SPRING_DATASOURCE_USERNAME
        sync: false
      - key: SPRING_DATASOURCE_PASSWORD
        sync: false
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_ANON_KEY
        sync: false
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false
      - key: CONTACT_IP_HASH_SALT
        sync: false
      - key: TURNSTILE_ENABLED
        value: "false"
      - key: TURNSTILE_SECRET_KEY
        sync: false
      - key: TURNSTILE_MINIMUM_SCORE
        value: "0.5"
      - key: SUPABASE_RESUME_BUCKET
        value: resumes
      - key: RESUME_FILE_EN
        value: resume_en.pdf
      - key: RESUME_FILE_FR
        value: resume_fr.pdf
      - key: RESUME_FILE_ES
        value: resume_es.pdf

  - type: web
    runtime: static
    name: virtual-portfolio-frontend
    rootDir: frontend
    buildCommand: npm ci && npm run build
    staticPublishPath: dist
    autoDeploy: true
    envVars:
      - key: VITE_API_BASE_URL
        sync: false
      - key: VITE_ADMIN_EMAILS
        sync: false
      - key: VITE_SUPABASE_DIRECT
        value: "false"
      - key: VITE_TURNSTILE_SITE_KEY
        sync: false
